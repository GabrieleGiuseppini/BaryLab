
- Particle state machine:
	+ Particles::StateType struct
		+ Stored in buffer as opt<.>
	+ State is:
		+ Current triangle
		+ Current barycentric coords
		+ Target position (copy of trajectory)
	+ Initialized at SetTrajectory (i.e. the final call), and at Move Particle and Move Vertex
		+ LabController::Simulation::InitializeParticleState(p)
			+ Only populated if there is a trajectory, and if particle is in a triangle
				+ Publish
			+ Else: nullopt
				+ Publish
	+ LabController::Update:
		+ For each particle that has a state:
			+ bool isCompleted = LabController::UpdateParticleState(.)
			+ if isComplete:
				+ Reset particle state
				+ Reset trajectory
				+ Publish
	+ Split state, ConstrainedState is opt
		+ Redo state initialization & publishing
			+ Publishing done @ end of update, at a single place
	= LabController::UpdateParticleState:
		+ If not in a triangle:
			+ Move to target
		+ If @ target:
			+ return true
		+ assert(InTriangle)
		- If on floor edge (based on current bary coords):
			+ AND: normal is opposite direction of trajectory
			+ AND: allow when inside floor to move like ghost: if not all edges are floor
			+ Test before & after
			+ return true
			- Test ghost condition
		+ Calc bary coords of target wrt current triangle
		+ If stricly inside:
			+ Move to target
			+ return true
		+ Find hit edge & coords on it
		+ Move to edge (pos + cur bary coords)
		+ If edge is floor:
			+ // Impact			
			+ return false
		+ Find next triangle
			+ Edges::GetOppositeTriangle(s, t)
		+ If no triangle found:
			+ // Become free
			+ Reset current triangle
			+ return false
		+ Move to edge of that next triangle (cur triangle + cur bary coords)
		+ return false
	- TODO:
		- Fix: starting on non-floor edge pointing outside and finding verlenging of edge: 
			- Issue 1: if t > 1.0 we think we end inside
			- Issue 2: if t <= 1.0 we do an extra step
			- In either case we should not find verlenging
		- Fix: dance when we are on edge - trying to get to other side alternatively
		- vec3_arr instead of vec3f::indexer?
		- TODO's


- Facilities to display:
	- Highlighted edge + "place" (for trajectory hitting edge)

- Take care of colinear triangle @ barycentric coords